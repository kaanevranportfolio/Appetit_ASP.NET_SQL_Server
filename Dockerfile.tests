FROM mcr.microsoft.com/dotnet/sdk:8.0

WORKDIR /app

# Copy project file and restore dependencies first for caching
COPY *.csproj ./
RUN dotnet restore

# Copy the rest of the source code
COPY . ./

# Build the project in Release configuration
RUN dotnet build --configuration Release --no-restore

# Create a directory for test results
RUN mkdir -p /app/TestResults

# The CMD instruction defines the command to run when the container starts.
# We use the JSON array format, which is the most reliable way to pass arguments.
CMD ["dotnet", "test", "--no-build", "--configuration", "Release", "--verbosity", "detailed", "--logger", "trx;LogFileName=test-results.trx", "--results-directory", "/app/TestResults"]